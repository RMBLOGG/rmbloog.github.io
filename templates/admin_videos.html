{% extends 'base.html' %}
{% block content %}
<!-- Videos Management Header -->
<div class="page-header">
    <div class="container">
        <div class="header-content">
            <div class="header-text">
                <h1 class="page-title">Video Management</h1>
                <p class="page-subtitle">Kelola semua video content StreamFlix</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="me-2">
                        <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
                    </svg>
                    Upload Video
                </button>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item active">Videos</li>
            </ol>
        </nav>
    </div>
</div>

<div class="container">
    <!-- Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-content">
                    <h3>{{ videos|length }}</h3>
                    <p>Total Videos</p>
                </div>
                <div class="stat-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Videos Table -->
    <div class="card">
        <div class="card-header">
            <h5 class="card-title">All Videos</h5>
            <div class="card-actions">
                <input type="text" class="form-control" placeholder="Search videos..." id="searchVideos">
            </div>
        </div>
        <div class="card-body">
            {% if videos %}
            <div class="table-responsive">
                <table class="table table-hover" id="videosTable">
                    <thead>
                        <tr>
                            <th>Video</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Uploaded</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for video in videos %}
                        <tr>
                            <td>
                                <div class="video-thumbnail">
                                    <video preload="metadata" class="thumbnail-video">
                                        <source src="{{ video.url }}" type="video/mp4">
                                    </video>
                                    <div class="play-overlay">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M8 5v14l11-7z"/>
                                        </svg>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <h6 class="video-title">{{ video.title }}</h6>
                            </td>
                            <td>
                                <p class="video-description">{{ video.description or 'No description' }}</p>
                            </td>
                            <td>
                                <small class="text-muted">{{ video.created_at.strftime('%d/%m/%Y') }}</small>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-outline-primary preview-video" 
                                            data-video-url="{{ video.url }}" 
                                            data-video-title="{{ video.title }}">
                                        Preview
                                    </button>
                                    <form action="{{ url_for('admin_delete', video_id=video.id) }}" method="POST" class="d-inline">
                                        <button type="button" class="btn btn-sm btn-outline-danger delete-video" 
                                                data-video-title="{{ video.title }}">
                                            Delete
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state text-center py-5">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" class="text-muted mb-3">
                    <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/>
                </svg>
                <h5>No Videos Yet</h5>
                <p class="text-muted">Upload your first video to get started</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    Upload First Video
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Upload New Video</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('admin_upload') }}" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="videoTitle" class="form-label">Video Title</label>
                        <input type="text" class="form-control" id="videoTitle" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="videoDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="videoDescription" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="videoFile" class="form-label">Video File</label>
                        <input type="file" class="form-control" id="videoFile" name="video" accept="video/*" required>
                        <div class="form-text">Supported formats: MP4, MOV, AVI, etc.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Upload Video</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewModalTitle">Video Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <video controls class="w-100" id="previewVideo">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete video "<span id="deleteVideoTitle"></span>"?</p>
                <p class="text-danger">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-danger">Delete Video</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Search functionality
document.getElementById('searchVideos').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#videosTable tbody tr');
    
    rows.forEach(row => {
        const title = row.querySelector('.video-title').textContent.toLowerCase();
        const description = row.querySelector('.video-description').textContent.toLowerCase();
        
        if (title.includes(searchTerm) || description.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

// Preview video
document.querySelectorAll('.preview-video').forEach(button => {
    button.addEventListener('click', function() {
        const videoUrl = this.getAttribute('data-video-url');
        const videoTitle = this.getAttribute('data-video-title');
        
        document.getElementById('previewModalTitle').textContent = videoTitle;
        document.getElementById('previewVideo').src = videoUrl;
        
        new bootstrap.Modal(document.getElementById('previewModal')).show();
    });
});

// Delete confirmation
document.querySelectorAll('.delete-video').forEach(button => {
    button.addEventListener('click', function() {
        const videoTitle = this.getAttribute('data-video-title');
        const form = this.closest('form');
        
        document.getElementById('deleteVideoTitle').textContent = videoTitle;
        document.getElementById('deleteForm').action = form.action;
        
        new bootstrap.Modal(document.getElementById('deleteModal')).show();
    });
});

// Reset preview modal when closed
document.getElementById('previewModal').addEventListener('hidden.bs.modal', function() {
    document.getElementById('previewVideo').pause();
    document.getElementById('previewVideo').src = '';
});
</script>
{% endblock %}