<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>StreamFlix</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    /* CSS Kustom untuk StreamFlix - MODERN DESIGN */
    :root {
      --primary-color: #4361ee;
      --primary-light: #4895ef;
      --secondary-color: #3f37c9;
      --accent-color: #f72585;
      --dark-color: #1e1e2c;
      --light-color: #f8f9fa;
      --gray-color: #6c757d;
      --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
      --gradient-accent: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.12);
      --shadow-heavy: 0 16px 48px rgba(0, 0, 0, 0.15);
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      color: var(--dark-color);
      line-height: 1.6;
    }
    
    
    /* Navbar styling */
.navbar-brand {
  font-weight: bold;
  font-size: 1.5rem;
}

.nav-link {
  display: flex;
  align-items: center;
  padding: 0.5rem 1rem;
  transition: all 0.3s ease;
}

.nav-link:hover {
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 0.375rem;
}

.dropdown-menu {
  border: none;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.dropdown-item {
  display: flex;
  align-items: center;
  padding: 0.5rem 1rem;
}

/* Search container styling */
.search-container {
  position: relative;
  margin-right: 1rem;
  flex: 1;
  max-width: 400px;
}

.search-input {
  width: 100%;
  padding: 0.5rem 2.5rem 0.5rem 2.5rem;
  border: none;
  border-radius: 1.5rem;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  transition: all 0.3s ease;
}

.search-input::placeholder {
  color: rgba(255, 255, 255, 0.7);
}

.search-input:focus {
  outline: none;
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
}

.search-icon {
  position: absolute;
  left: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255, 255, 255, 0.7);
}

.search-results {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border-radius: 0.5rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  max-height: 300px;
  overflow-y: auto;
  z-index: 1000;
  display: none;
}

/* Responsive */
@media (max-width: 768px) {
  .search-container {
    margin: 1rem 0;
    max-width: 100%;
  }
  
  .navbar-nav {
    flex-direction: column;
    width: 100%;
  }
  
  .nav-item {
    width: 100%;
  }
  
  .btn {
    width: 100%;
    margin: 0.25rem 0;
  }
}
    
    

    /* Navbar Styling - MODERN */
    .navbar {
      background: var(--gradient-primary) !important;
      box-shadow: var(--shadow-medium);
      padding: 0.8rem 0;
      transition: var(--transition);
      position: relative;
      z-index: 1030;
    }

    .navbar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      z-index: -1;
    }

    .navbar-brand {
      font-weight: 800;
      font-size: 1.8rem;
      letter-spacing: -0.5px;
      color: white !important;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      transition: var(--transition);
    }

    .navbar-brand:hover {
      transform: translateY(-1px);
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .navbar-brand::before {
      content: 'â–¶';
      display: inline-block;
      margin-right: 8px;
      font-size: 1.5rem;
      transform: scale(1.2);
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }

    /* Search Bar Styles - MODERN */
    .search-container {
      position: relative;
      max-width: 500px;
      flex: 1;
      margin: 0 2rem;
    }

    .search-input {
      border: none;
      border-radius: 50px;
      padding: 0.75rem 1rem 0.75rem 3rem;
      width: 100%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      color: white;
      transition: var(--transition);
      font-size: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .search-input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .search-input:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      transform: scale(1.02);
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255, 255, 255, 0.8);
      z-index: 2;
      transition: var(--transition);
    }

    .search-input:focus + .search-icon {
      color: white;
      transform: translateY(-50%) scale(1.1);
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border-radius: 16px;
      box-shadow: var(--shadow-heavy);
      z-index: 1000;
      max-height: 400px;
      overflow-y: auto;
      display: none;
      margin-top: 8px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .search-result-item {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid #f1f3f4;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: flex-start;
    }

    .search-result-item:hover {
      background-color: #f8f9fa;
      transform: translateX(4px);
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .search-result-icon {
      margin-right: 12px;
      color: var(--primary-color);
      flex-shrink: 0;
      margin-top: 2px;
    }

    .search-result-content {
      flex: 1;
    }

    .search-result-title {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
      color: var(--dark-color);
      line-height: 1.4;
    }

    .search-result-description {
      font-size: 0.85rem;
      color: var(--gray-color);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.4;
    }

    .search-result-meta {
      font-size: 0.75rem;
      color: var(--gray-color);
      margin-top: 0.25rem;
      display: flex;
      align-items: center;
    }

    .search-result-meta svg {
      margin-right: 4px;
    }

    .view-all-results {
      padding: 1rem 1.25rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      text-align: center;
      font-weight: 600;
      color: var(--primary-color);
      border-radius: 0 0 16px 16px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .view-all-results:hover {
      background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
      color: var(--secondary-color);
    }

    .view-all-results svg {
      margin-left: 8px;
      transition: transform 0.3s ease;
    }

    .view-all-results:hover svg {
      transform: translateX(4px);
    }

    /* Buttons - MODERN */
    .btn-outline-light {
      border: 2px solid rgba(255, 255, 255, 0.7);
      color: white;
      font-weight: 500;
      border-radius: 8px;
      padding: 0.5rem 1.25rem;
      transition: var(--transition);
      backdrop-filter: blur(10px);
    }

    .btn-outline-light:hover {
      background-color: white;
      color: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
      border-color: white;
    }

    .btn-light {
      background-color: white;
      color: var(--primary-color);
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1.25rem;
      transition: var(--transition);
      box-shadow: var(--shadow-light);
    }

    .btn-light:hover {
      background-color: #f8f9fa;
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    /* Container Styling */
    .container.py-4 {
      padding-top: 2rem !important;
      padding-bottom: 2rem !important;
    }

    /* Alert Styling - MODERN */
    .alert {
      border: none;
      border-radius: 12px;
      box-shadow: var(--shadow-light);
      padding: 1rem 1.5rem;
      backdrop-filter: blur(10px);
    }

    .alert-dismissible .btn-close {
      padding: 1rem;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }

    /* Mobile Responsive */
    @media (max-width: 992px) {
      .search-container {
        margin: 1rem 0;
        max-width: 100%;
        order: 3;
        width: 100%;
      }
      
      .navbar .container {
        flex-wrap: wrap;
      }
      
      .navbar-brand {
        font-size: 1.6rem;
      }
    }

    @media (max-width: 576px) {
      .navbar-brand {
        font-size: 1.4rem;
      }
      
      .search-input {
        padding: 0.65rem 1rem 0.65rem 2.75rem;
        font-size: 0.9rem;
      }
      
      .search-icon {
        left: 0.875rem;
      }
      
      .btn-outline-light, .btn-light {
        padding: 0.4rem 1rem;
        font-size: 0.875rem;
      }
    }

    /* Animation for search results */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .search-results.show {
      display: block;
      animation: slideDown 0.3s ease forwards;
    }

    /* Loading state for search */
    .search-loading {
      position: relative;
    }

    .search-loading::after {
      content: '';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top: 2px solid rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: translateY(-50%) rotate(0deg); }
      100% { transform: translateY(-50%) rotate(360deg); }
    }

    /* Navbar Toggler */
    .navbar-toggler {
      border: none;
      padding: 0.25rem 0.5rem;
    }

    .navbar-toggler:focus {
      box-shadow: none;
    }

    .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.8%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('index') }}">StreamFlix</a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="navbarContent">
      <!-- Search Bar -->
      <div class="search-container">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <input type="text" class="search-input" placeholder="Cari video..." id="searchInput">
        <div class="search-results" id="searchResults"></div>
      </div>

      <!-- Navigation Links -->
      <ul class="navbar-nav ms-auto me-3">
        {% if not current_user.is_authenticated %}
          <!-- Demo Link -->
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('demo') }}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="me-1">
                <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/>
              </svg>
              Demo
            </a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('payment_gateway') }}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="me-1">
                <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.9 1 3 1.9 3 3V21C3 22.1 3.9 23 5 23H19C20.1 23 21 22.1 21 21V9ZM19 9H14V4L19 9ZM10 13C8.9 13 8 13.9 8 15C8 16.1 8.9 17 10 17C11.1 17 12 16.1 12 15C12 13.9 11.1 13 10 13ZM16 21.5L8 21.5V20L16 20V21.5Z"/>
              </svg>
              Payment
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('access_code') }}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="me-1">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              Access Code
            </a>
          </li>
        {% endif %}
      </ul>

      <!-- Auth Buttons -->
<!--       <div class="navbar-nav">
  {% if current_user.is_authenticated %}
    <a class="btn btn-outline-light me-2" href="{{ url_for('admin_dashboard') }}">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="me-1">
        <path d="M3 13h1v7c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-7h1c.55 0 1-.45 1-1s-.45-1-1-1h-1V4c0-1.1-.9-2-2-2H6C4.9 2 4 2.9 4 4v7H3c-.55 0-1 .45-1 1s.45 1 1 1zM6 4h12v7H6V4z"/>
      </svg>
      Dashboard
    </a>
    <a class="btn btn-light" href="{{ url_for('logout') }}">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="me-1">
        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
      </svg>
      Logout
    </a>
  {% else %}
    <a class="btn btn-light" href="{{ url_for('admin_login') }}">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="me-1">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      Admin Login
    </a>
  {% endif %}
</div> -->
    </div>
  </div>
</nav>

<div class="container py-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="alert alert-{{ cat }} alert-dismissible fade show" role="alert">
          {{ msg }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Live Search Functionality - TIDAK DIUBAH
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    let searchTimeout;

    searchInput.addEventListener('input', function() {
      clearTimeout(searchTimeout);
      const query = this.value.trim();

      if (query.length < 2) {
        searchResults.style.display = 'none';
        return;
      }

      searchTimeout = setTimeout(() => {
        performSearch(query);
      }, 300);
    });

    searchInput.addEventListener('focus', function() {
      const query = this.value.trim();
      if (query.length >= 2 && searchResults.innerHTML !== '') {
        searchResults.style.display = 'block';
      }
    });

    // Hide results when clicking outside
    document.addEventListener('click', function(e) {
      if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        searchResults.style.display = 'none';
      }
    });

    function performSearch(query) {
      fetch(`/api/search?q=${encodeURIComponent(query)}&limit=5`)
        .then(response => response.json())
        .then(data => {
          displaySearchResults(data.videos, query);
        })
        .catch(error => {
          console.error('Search error:', error);
        });
    }

    function displaySearchResults(videos, query) {
      if (videos.length === 0) {
        searchResults.innerHTML = `
          <div class="search-result-item">
            <div class="text-muted">Tidak ada hasil untuk "${query}"</div>
          </div>
        `;
      } else {
        searchResults.innerHTML = videos.map(video => `
          <div class="search-result-item" onclick="navigateToVideo('${video.url}')">
            <div class="search-result-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </div>
            <div class="search-result-content">
              <div class="search-result-title">${video.title}</div>
              <div class="search-result-description">${video.description || 'Tidak ada deskripsi'}</div>
              <div class="search-result-meta">
                <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M14 0H2C0.9 0 0 0.9 0 2V14C0 15.1 0.9 16 2 16H14C15.1 16 16 15.1 16 14V2C16 0.9 15.1 0 14 0ZM14 14H2V2H14V14Z"/>
                  <path d="M11 7H8V4C8 3.4 7.6 3 7 3C6.4 3 6 3.4 6 4V8C6 8.6 6.4 9 7 9H11C11.6 9 12 8.6 12 8C12 7.4 11.6 7 11 7Z"/>
                </svg>
                ${video.created_at}
              </div>
            </div>
          </div>
        `).join('') + `
          <div class="view-all-results" onclick="navigateToSearch('${query}')">
            Lihat semua hasil (${videos.length})
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
            </svg>
          </div>
        `;
      }
      searchResults.style.display = 'block';
    }

    // Handle Enter key press
    searchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const query = this.value.trim();
        if (query.length >= 2) {
          window.location.href = `/search?q=${encodeURIComponent(query)}`;
        }
      }
    });
  });

  // Global functions for search results - TIDAK DIUBAH
  function navigateToVideo(videoUrl) {
    // You might want to open video in modal or redirect to specific video page
    // For now, let's just alert and redirect to index
    window.location.href = '/';
  }

  function navigateToSearch(query) {
    window.location.href = `/search?q=${encodeURIComponent(query)}`;
  }

  // Navbar scroll effect - TAMBAHAN BARU
  window.addEventListener('scroll', function() {
    const navbar = document.querySelector('.navbar');
    if (window.scrollY > 50) {
      navbar.style.boxShadow = '0 8px 32px rgba(0, 0, 0, 0.2)';
      navbar.style.backdropFilter = 'blur(10px)';
    } else {
      navbar.style.boxShadow = 'var(--shadow-medium)';
      navbar.style.backdropFilter = 'none';
    }
  });
</script>
</body>
</html>